<p-table
  #dt2
  [columns]="cols"
  [paginator]="true"
  [rows]="5"
  [rowsPerPageOptions]="[5, 10, 20, 30]"
  [totalRecords]="statusList?.length"
  [value]="statusList"
  [scrollable]="true"
  scrollHeight="200px"
>
  <ng-template pTemplate="caption">
    <div class="ui-g">
      <div class="ui-g-12 ui-md-4 mx-0">
        <div style="text-align:left">
          <p-multiSelect
            [options]="selectedStatusColumns"
            optionLabel="header"
            name="cols"
            selectedItemsLabel="{0} columns selected"
            [style]="{ minWidth: '200px' }"
            [(ngModel)]="cols"
            defaultLabel="Choose Columns"
            ngDefaultControl
          ></p-multiSelect>
        </div>
      </div>
      <div class="ui-inputgroup ui-inputgroup-cust ui-g-6 mx-0">
        <div class="relative">
          <input
            type="text"
            pInputText
            placeholder="Search Data globally"
            (input)="dt2.filterGlobal($event.target.value, 'contains')"
            class="input-ctrl input-search-type"
          />
          <button type="submit" class="input-search pi pi-search"></button>
        </div>
      </div>
      <div class="ui-inputgroup ui-inputgroup-cust ui-g-2 mx-0">
        <ey-year-dropdown [id]="year" (selectedYear)="yearTrigger($event)">
        </ey-year-dropdown>
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="colgroup" let-columns>
    <colgroup>
      <col
        *ngFor="let col of columns"
        style="width:200px"
        [style.width]="col.width"
      />
    </colgroup>
  </ng-template>
  <ng-template pTemplate="header" let-columns>
    <tr>
      <th
        *ngFor="let col of columns"
        [pSortableColumn]="col.field"
        [style.width]="col.width"
      >
        {{ col.header }}
        <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-columns="columns">
    <tr>
      <td
        *ngFor="let col of columns"
        [style.width]="col.width"
        [ngClass]="{
          'bg-danger':
            (col.field == 'status' || col.field == 'fileStatus') &&
            (rowData['status'] === 'Failed' ||
              rowData['fileStatus'] === 'Failed' ||
              (rowData['status'] === 'Process Failed' ||
                rowData['fileStatus'] === 'Process Failed') ||
              (rowData['status'] === 'Duplicate' ||
                rowData['fileStatus'] === 'Duplicate') ||
              (rowData['status'] === 'File Error' ||
                rowData['fileStatus'] === 'File Error')),
          'bg-success':
            (col.field == 'status' || col.field == 'fileStatus') &&
            (rowData['status'] === 'Processed' ||
              rowData['fileStatus'] === 'Processed' ||
              (rowData['status'] === 'Transformation done' ||
                rowData['fileStatus'] === 'Transformation done')),
          'bg-info':
            (col.field == 'status' || col.field == 'fileStatus') &&
            (rowData['status'] === 'Uploaded' ||
              rowData['fileStatus'] === 'Uploaded' ||
              (rowData['status'] === 'Processing' ||
                rowData['fileStatus'] === 'Processing') ||
              (rowData['status'] === 'Requested' ||
                rowData['fileStatus'] === 'Requested'))
        }"
      >
        <span *ngIf="col.type !== 'date'">
          <span
            *ngIf="
              col.field !== 'errorRecords' &&
              col.field !== 'failedCount' &&
              col.field !== 'uploadedFileDownloadUrl' &&
              col.field !== 'status' &&
              col.field !== 'fileStatus' &&
              col.field !== 'fileName' &&
              col.type !== 'long-text' &&
              col.field !== 'filePath'
            "
          >
            {{ rowData[col.field] }}
          </span>
          <span *ngIf="col.field == 'status' || col.field == 'fileStatus'">
            <span
              *ngIf="
                rowData['status'] === 'Failed' ||
                rowData['fileStatus'] === 'Failed' ||
                (rowData['status'] === 'Process Failed' ||
                  rowData['fileStatus'] === 'Process Failed') ||
                (rowData['status'] === 'File Error' ||
                  rowData['fileStatus'] === 'File Error')
              "
              ngbTooltip="Something went wrong in processing"
              container="body"
            >
              {{ rowData[col.field] }}
            </span>
            <span
              *ngIf="
                rowData['status'] === 'Duplicate' ||
                rowData['fileStatus'] === 'Duplicate'
              "
              ngbTooltip="File already exists in process queue"
              container="body"
            >
              {{ rowData[col.field] }}
            </span>
            <span
              *ngIf="
                rowData['status'] === 'Uploaded' ||
                rowData['fileStatus'] === 'Uploaded' ||
                (rowData['status'] === 'Processing' ||
                  rowData['fileStatus'] === 'Processing')
              "
              ngbTooltip="Process initiated"
              container="body"
            >
              {{ rowData[col.field] }}
            </span>
            <span
              *ngIf="
                rowData['status'] === 'Processed' ||
                rowData['fileStatus'] === 'Processed'
              "
              ngbTooltip="Processed successfully"
              container="body"
            >
              {{ rowData[col.field] }}
            </span>
          </span>
          <p
            *ngIf="col.type === 'long-text'"
            class="ellipse"
            [ngbTooltip]="rowData[col.field]"
            container="body"
          >
            {{ rowData[col.field] }}
          </p>
          <p
            *ngIf="col.field == 'fileName'"
            class="ellipse"
            [ngbTooltip]="rowData[col.field]"
            container="body"
          >
            {{ rowData[col.field] }}
          </p>

          <!--   <span
            *ngIf="col.field == 'errorRecords' || col.field == 'failedCount'"
          >
            {{ rowData[col.field] }}
          </span> -->
          <ey-download-link
            [rowData]="rowData"
            *ngIf="col.field == 'errorRecords' || col.field == 'failedCount'"
            [data]="data"
            [type]="'ERROR'"
            [isDownload]="true"
            [module]="'batch-error'"
            [value]="rowData[col.field]"
          >
          </ey-download-link>

          <p *ngIf="col.field == 'filePath'">
            <ey-download-link
              [rowData]="rowData"
              [module]="'batch'"
              [data]="data"
              [type]="'UPLOADED'"
              [isDownload]="true"
              [value]="'File'"
            >
            </ey-download-link>
          </p>
        </span>
        <span
          *ngIf="
            col.type === 'date' &&
            col.field === 'processEndTime' &&
            (rowData['status'] === 'Processed' ||
              rowData['fileStatus'] === 'Processed')
          "
        >
          {{ rowData[col.field] | date: 'dd/MM/yyyy h:mm:ss a' }}</span
        >
        <span *ngIf="col.type === 'date' && col.field !== 'processEndTime'">{{
          rowData[col.field] | date: 'dd/MM/yyyy h:mm:ss a'
        }}</span>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage" let-columns>
    <tr>
      <td [attr.colspan]="columns.length">
        No records found
      </td>
    </tr>
  </ng-template>
</p-table>
