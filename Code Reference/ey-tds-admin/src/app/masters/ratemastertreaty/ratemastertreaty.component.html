<div class="ui-g-12">
  <div class="ui-g-6 mx-0">
    <h2 class="fs-22 mb-0">Dividend rate - Treaty</h2>
  </div>
  <div class="ui-g-6 mx-0 text-right">
    <ey-download-template
      [templateName]="'Dividend Treaty Template'"
      [templateType]="'dividend_treaty_master'"
    >
    </ey-download-template>
    <button
      type="button"
      class="ui-button btn-secondary"
      (click)="showDialog()"
    >
      <i class="fas fa-upload"></i> Upload
    </button>
    <span *HasAnyAuthority="['DIVIDEND_RATETREATY_CREATE']">
      <button
        type="button"
        class="ui-button btn-primary"
        [routerLink]="['form']"
      >
        <i class="fa fa-plus mr-5"></i> Add New
      </button>
      <button
        type="button"
        class="ui-button btn-secondary"
        (click)="refreshData()"
      >
        <i class="fas fa-sync"></i> Refresh data
      </button>
    </span>
  </div>
</div>
<div class="ui-g-12 mb-100" *HasAnyAuthority="['DIVIDEND_RATETREATY_LIST']">
  <div class="p-20 pt-10 border">
    <p-tabView class="table-tab-view" (onChange)="onTabChange($event)">
      <p-tabPanel header="Dividend treaty list">
        <p-table
          #dt
          [columns]="selectedColumns"
          [paginator]="true"
          [rows]="5"
          [rowsPerPageOptions]="[5, 10, 20, 30]"
          [totalRecords]="rateMasterTreatyList?.length"
          [value]="rateMasterTreatyList"
          [scrollable]="true"
          [resizableColumns]="true"
          scrollHeight="400px"
        >
          <ng-template pTemplate="caption">
            <div class="ui-g mt-0">
              <div class="ui-g-12 ui-md-4 mx-0">
                <div style="text-align:left">
                  <p-multiSelect
                    [options]="cols"
                    optionLabel="header"
                    name="selectedColumns"
                    selectedItemsLabel="{0} columns selected"
                    [style]="{ minWidth: '200px' }"
                    [(ngModel)]="selectedColumns"
                    defaultLabel="Choose Columns"
                    ngDefaultControl
                  ></p-multiSelect>
                </div>
              </div>
              <div class="ui-inputgroup ui-inputgroup-cust ui-g-8 mx-0">
                <div class="relative">
                  <input
                    type="text"
                    pInputText
                    placeholder="Search data globally"
                    (input)="dt.filterGlobal($event.target.value, 'contains')"
                    class="input-ctrl input-search-type"
                  />
                  <button
                    type="submit"
                    class="input-search pi pi-search"
                  ></button>
                </div>
              </div>
            </div>
          </ng-template>
          <ng-template pTemplate="colgroup" let-columns="columns">
            <colgroup>
              <col *ngFor="let col of columns" [style.width]="col.width" />
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header" let-columns>
            <tr>
              <th
                *ngFor="let col of columns; let i = index"
                [pSortableColumn]="col.field"
                [style.width]="col.width"
              >
                {{ col.header }}
                <p-sortIcon [field]="col.field"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-columns="columns">
            <tr>
              <td
                *ngFor="let col of columns; let i = index"
                [style.width]="col.width"
              >
                <a
                  *ngIf="col.type === 'initial'"
                  [routerLink]="['form']"
                  [queryParams]="{ action: 'view', id: rowData.id }"
                >
                  {{ rowData[col.field] }}
                </a>
                <span *ngIf="col.type === 'date'">{{
                  rowData[col.field] | date: 'dd/MM/yyyy h:mm:ss a'
                }}</span>
                <p *ngIf="col.type === 'longtext'" class="ellipse">
                  {{ rowData[col.field] }}
                </p>
                <span *HasAnyAuthority="['DIVIDEND_RATETREATY_UPDATE']">
                  <a
                    href="#"
                    *ngIf="col.type === 'action'"
                    class="text-right"
                    [routerLink]="['form']"
                    [queryParams]="{ action: 'edit', id: rowData.id }"
                  >
                    Edit
                  </a>
                </span>
                <span
                  *ngIf="!col.type"
                  [ngbTooltip]="rowData[col.field]"
                  container="body"
                  >{{ rowData[col.field] }}</span
                >
                <p class="ellipse" *ngIf="col.type === 'array'">
                  <span *ngFor="let item of rowData[col.field]" class="mr-10">{{
                    item.nature
                  }}</span>
                </p>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
              <td [attr.colspan]="columns.length">
                No records found
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>
      <p-tabPanel header="File processing status">
        <ey-batch-upload-table
          [tableData]="statusList"
          [fileType]="fileTypeOf"
          (year)="getSelectedYear($event)"
        >
        </ey-batch-upload-table>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>
<p-dialog
  header="Upload"
  [(visible)]="display"
  [style]="{ width: '800px' }"
  [modal]="true"
  [responsive]="true"
  [contentStyle]="{ overflow: 'visible' }"
  [minY]="70"
  (onHide)="clearUpload()"
  [maximizable]="true"
  [baseZIndex]="10000"
>
  <form [formGroup]="ratemasterUploadForm">
    <div class="p-20">
      <div
        class="no-files m-20"
        *ngIf="!filesExists && !uploadSuccess && !uploadError && !fileLoading"
      >
        <p class="fs-18">
          No files added. Please click add files button to upload files.
        </p>
        <span class="fs-14 mt-20">
          Note: Upload .xlsx files only.
        </span>
      </div>
      <div class="text-center my-50" *ngIf="fileLoading">
        <i class="fs-24 fas fa-hourglass-start fa-spin text-success mb-30"></i>
        <p class="fs-16">Your file is being processed. please wait.</p>
      </div>
      <div class="text-center my-50" *ngIf="uploadSuccess">
        <i class="fs-80 fa fa-check-circle text-success mb-30"></i>
        <p class="fs-24">File Uploaded Successfully.</p>
      </div>
      <div class="text-center my-50" *ngIf="uploadError">
        <i class="fs-80 fa fa-times text-danger mb-30"></i>
        <p class="fs-24">Processing failed.</p>
      </div>
      <div
        class="files p-20"
        *ngIf="filesExists && !uploadSuccess && !uploadError && !fileLoading"
      >
        <div class="alert alert-success">
          {{ rawValues?.file.name }} has been added successfully. Please click
          upload files to process files.
        </div>
        <div class="bg-light mb-10 p-20 row mx-0">
          <div class="col-sm-8">
            {{ rawValues.file.name }}
          </div>
          <div class="col-sm-2">
            {{ formatBytes(rawValues.file.size) }}
          </div>
          <div class="col-sm-2">
            <button
              type="button"
              class="ui-button btn-secondary"
              (click)="removeFiles()"
            >
              <i class="pi pi-times"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
  <p-footer *ngIf="!fileLoading && !uploadSuccess && !uploadError">
    <span *ngIf="!filesExists">
      <input
        type="file"
        class="inputfile"
        id="invoicefiles"
        (change)="uploadHandler($event)"
        accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
      />
      <label for="invoicefiles" class="mb-0">Add files</label>
    </span>
    <button
      type="button"
      class="ui-button btn-secondary"
      *ngIf="filesExists"
      (click)="uploadFiles()"
    >
      Upload files
    </button>
  </p-footer>
</p-dialog>
<div class="fixed-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <button
          (click)="backClick()"
          type="button"
          class="ui-button btn-utility"
        >
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>
    </div>
  </div>
</div>
