<div class="ui-g-6 mx-0">
  <h2 class="fs-22">{{ headingMsg }} Non-Resident master</h2>
</div>
<div class="ui-g-6 text-right">
  <span *HasAnyAuthority="['ARTICLE_UPDATE']">
    <button
      (click)="stateChanger('edit', data)"
      type="button"
      class="ui-button btn-primary"
      *ngIf="actionState === 'VIEW'"
    >
      Edit
    </button>
  </span>
</div>

<div class="ui-g-12">
  <form [formGroup]="articleMasterForm">
    <div class="ui-inputgroup  ui-g-12 mb-0">
      <div class="form-row">
        <div
          class="ui-inputgroup  ui-g-4"
          [ngClass]="{
            'field-invalid': submitted && f.country.errors
          }"
        >
          <label>Country</label>
          <p-dropdown
            [options]="allcountries"
            [value]="articleMasterForm.getRawValue().country"
            ngDefaultControl
            formControlName="country"
          ></p-dropdown>
          <div
            *ngIf="submitted && (f.country.untouched || f.country.errors)"
            class="error-feedback"
          >
            <div *ngIf="f.country.errors?.required">
              Please select the country name.
            </div>
          </div>
        </div>
        <div
          class="ui-inputgroup   ui-g-4"
          [ngClass]="{
            'field-invalid': submitted && f.articleNumber.errors
          }"
        >
          <label>Article number</label>
          <input
            type="text"
            maxlength="10"
            formControlName="articleNumber"
            placeholder="Enter article number"
            class="input-ctrl"
          />
          <div
            *ngIf="submitted && f.articleNumber.errors"
            class="error-feedback"
          >
            <div *ngIf="f.articleNumber.errors?.required">
              Please enter an article number.
            </div>
          </div>
        </div>
        <div
          class="ui-inputgroup   ui-g-4"
          [ngClass]="{ 'field-invalid': submitted && f.articleName.errors }"
        >
          <label>Article name</label>
          <input
            type="text"
            maxlength="10"
            formControlName="articleName"
            placeholder="Enter article name"
            class="input-ctrl"
          />
          <div *ngIf="submitted && f.articleName.errors" class="error-feedback">
            <div *ngIf="f.articleName.errors?.required">
              Please enter an article name.
            </div>
          </div>
        </div>
      </div>
      <div
        class="ui-inputgroup  ui-g-12"
        [ngClass]="{
          'field-invalid': submitted && f.natureOfRemittance.errors
        }"
      >
        <label>Nature of remittance</label>
        <p-dropdown
          [options]="natureOfRemittanceArray"
          [value]="articleMasterForm.getRawValue().natureOfRemittance"
          ngDefaultControl
          formControlName="natureOfRemittance"
        ></p-dropdown>
        <div
          *ngIf="
            submitted &&
            (f.natureOfRemittance.untouched || f.natureOfRemittance.errors)
          "
          class="error-feedback"
        >
          <div *ngIf="f.natureOfRemittance.errors?.required">
            Please select the Nature Of Remittance.
          </div>
        </div>
      </div>
      <div
        class="ui-inputgroup  ui-g-4 mb-0"
        [ngClass]="{
          'field-invalid': submitted && f.exempt.errors
        }"
        *ngIf="
          articleMasterForm.getRawValue().natureOfRemittance === 'interest'
        "
      >
        <label>Exempt?</label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="exempt"
            id="exempt1"
            [value]="true"
            formControlName="exempt"
            [ngClass]="{
              'is-invalid': submitted && f.exempt.errors
            }"
          />
          <label class="form-check-label">
            Yes
          </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="exempt"
            type="radio"
            name="exempt"
            id="exempt2"
            [ngClass]="{
              'is-invalid': submitted && f.exempt.errors
            }"
            [value]="false"
          />
          <label class="form-check-label">
            No
          </label>
        </div>
      </div>
      <div
        class="ui-inputgroup  ui-g-4 mb-0"
        [ngClass]="{
          'field-invalid': submitted && f.makeAvailableConditionSatisfied.errors
        }"
      >
        <label>Do you want to make available condition satisfied?</label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="makeAvailableConditionSatisfied"
            id="makeAvailableConditionSatisfied1"
            [value]="true"
            formControlName="makeAvailableConditionSatisfied"
            [ngClass]="{
              'is-invalid':
                submitted && f.makeAvailableConditionSatisfied.errors
            }"
          />
          <label class="form-check-label">
            Yes
          </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="makeAvailableConditionSatisfied"
            type="radio"
            name="makeAvailableConditionSatisfied"
            id="makeAvailableConditionSatisfied2"
            [ngClass]="{
              'is-invalid':
                submitted && f.makeAvailableConditionSatisfied.errors
            }"
            [value]="false"
          />
          <label class="form-check-label">
            No
          </label>
        </div>
      </div>
      <div
        class="ui-inputgroup  ui-g-4 mb-0"
        [ngClass]="{
          'field-invalid': submitted && f.mfnClauseExists.errors
        }"
      >
        <label>is Most Favoured Nation ('MFN') Clause Exists?</label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="mfnClauseExists"
            id="mfnClauseExists1"
            [value]="true"
            formControlName="mfnClauseExists"
            [ngClass]="{
              'is-invalid': submitted && f.mfnClauseExists.errors
            }"
          />
          <label class="form-check-label">
            Yes
          </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="mfnClauseExists"
            type="radio"
            name="mfnClauseExists"
            id="mfnClauseExists2"
            [ngClass]="{
              'is-invalid': submitted && f.mfnClauseExists.errors
            }"
            [value]="false"
          />
          <label class="form-check-label">
            No
          </label>
        </div>
      </div>
      <div
        class="ui-inputgroup  ui-g-4 mb-0"
        [ngClass]="{
          'field-invalid': submitted && f.mliPrinciplePurpose.errors
        }"
      >
        <label>is MLI Principle Purpose Test Condition Satisfied?</label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="mliPrinciplePurpose"
            id="mliPrinciplePurpose1"
            [value]="true"
            formControlName="mliPrinciplePurpose"
            [ngClass]="{
              'is-invalid': submitted && f.mliPrinciplePurpose.errors
            }"
          />
          <label class="form-check-label">
            Yes
          </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="mliPrinciplePurpose"
            type="radio"
            name="mliPrinciplePurpose"
            id="mliPrinciplePurpose2"
            [ngClass]="{
              'is-invalid': submitted && f.mliPrinciplePurpose.errors
            }"
            [value]="false"
          />
          <label class="form-check-label">
            No
          </label>
        </div>
      </div>
      <div class="ui-g-12">
        <div
          class="ui-inputgroup  ui-g-4 mb-0"
          [ngClass]="{
            'field-invalid': submitted && f.mliSimplifiedLimitation.errors
          }"
        >
          <label
            >is MLI Simplified Limitation on Benefit Condition Satisifed?</label
          >
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="mliSimplifiedLimitation"
              id="mliSimplifiedLimitation1"
              [value]="true"
              formControlName="mliSimplifiedLimitation"
              [ngClass]="{
                'is-invalid': submitted && f.mliSimplifiedLimitation.errors
              }"
            />
            <label class="form-check-label">
              Yes
            </label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              formControlName="mliSimplifiedLimitation"
              type="radio"
              name="mliSimplifiedLimitation"
              id="mliSimplifiedLimitation2"
              [ngClass]="{
                'is-invalid': submitted && f.mliSimplifiedLimitation.errors
              }"
              [value]="false"
            />
            <label class="form-check-label">
              No
            </label>
          </div>
        </div>
        <div
          class="cust-lable-ng-p ui-g-4"
          [ngClass]="{
            'field-invalid': submitted && f.mfnClauseIsAvailed.errors
          }"
        >
          <label
            >Withholding tax rate if benefit of Most Favoured Nation ('MFN')
            clause is availed</label
          >
          <input
            type="number"
            eyRatedecimalfloter
            formControlName="mfnClauseIsAvailed"
            placeholder="Enter withholding rate"
            class="input-ctrl w-100"
          />
          <div
            *ngIf="submitted && f.mfnClauseIsAvailed.errors"
            class="error-feedback"
          >
            <div *ngIf="f.mfnClauseIsAvailed.errors?.required">
              Please enter value.
            </div>
          </div>
        </div>
        <div
          class="cust-lable-ng-p ui-g-4"
          [ngClass]="{
            'field-invalid': submitted && f.mfnClauseIsNotAvailed.errors
          }"
        >
          <label
            >Withholding tax rate if benefit of Most Favoured Nation ('MFN')
            clause is not availed</label
          >
          <input
            type="number"
            eyRatedecimalfloter
            formControlName="mfnClauseIsNotAvailed"
            placeholder="Enter withholding rate"
            class="input-ctrl w-100"
          />
          <div
            *ngIf="submitted && f.mfnClauseIsNotAvailed.errors"
            class="error-feedback"
          >
            <div *ngIf="f.mfnClauseIsNotAvailed.errors?.required">
              Please enter value.
            </div>
          </div>
        </div>
      </div>
      <div
        class="ui-inputgroup  ui-g-12 mb-0"
        [ngClass]="{
          'field-invalid': submitted && f.isInclusionOrExclusion.errors
        }"
      >
        <label>Is this an Inclusion or Exclusion condition?</label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="isInclusionOrExclusion"
            id="subNatureOfPaymentRadios1"
            [value]="true"
            formControlName="isInclusionOrExclusion"
            [ngClass]="{
              'is-invalid': submitted && f.isInclusionOrExclusion.errors
            }"
          />
          <label class="form-check-label">
            Inclusion
          </label>
        </div>
        <div class="form-check">
          <input
            class="form-check-input"
            formControlName="isInclusionOrExclusion"
            type="radio"
            name="isInclusionOrExclusion"
            id="subNatureOfPaymentRadios2"
            [ngClass]="{
              'is-invalid': submitted && f.isInclusionOrExclusion.errors
            }"
            [value]="false"
          />
          <label class="form-check-label">
            Exclusion
          </label>
        </div>
        <div formArrayName="articleMasterConditions">
          <div
            *ngFor="
              let articleMasterConditions of getMasterConditions(
                articleMasterForm
              );
              let i = index
            "
          >
            <div [formGroupName]="i" class="ui-inputgroup ui-g-12 mt-10 mb-0">
              <div *ngIf="articleMasterForm.value.isInclusionOrExclusion">
                <!-- <label>Inclusion condition</label>
                <input type="text" placeholder="Enter inclusion condition" maxlength="100" class="input-ctrl"
                  formControlName="condition" pInputText /> -->
                <div
                  [ngClass]="{
                    'field-invalid':
                      submitted &&
                      articleMasterConditions.get('condition').errors
                  }"
                >
                  <label>Inclusion condition</label>
                  <input
                    type="text"
                    placeholder="Enter inclusion condition"
                    maxlength="100"
                    class="input-ctrl"
                    formControlName="condition"
                    pInputText
                  />
                  <div
                    *ngIf="
                      submitted &&
                      articleMasterConditions.get('condition').errors
                    "
                    class="error-feedback"
                  >
                    <div
                      *ngIf="
                        articleMasterConditions.get('condition').errors
                          ?.required
                      "
                    >
                      Please enter an inclusion condition.
                    </div>
                  </div>
                </div>
                <div class="ui-inputgroup ui-g-12 mt-10">
                  <label for="inputPassword4"
                    >Is a detailed inclusion condition applicable?</label
                  >
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="isDetailedConditionApplicable"
                      id="subNatureOfPaymentRadios3"
                      [value]="true"
                      formControlName="isDetailedConditionApplicable"
                      (change)="disableDetailsFields(true)"
                    />
                    <label class="form-check-label" for="exampleRadios1">
                      Yes
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="isDetailedConditionApplicable"
                      id="subNatureOfPaymentRadios3"
                      [value]="false"
                      formControlName="isDetailedConditionApplicable"
                      (change)="disableDetailsFields(false)"
                    />
                    <label class="form-check-label" for="exampleRadios2">
                      No
                    </label>
                    <div
                      *ngIf="
                        submitted &&
                        articleMasterConditions.controls
                          .isDetailedConditionApplicable.errors
                      "
                      class="error-feedback"
                    >
                      <div
                        *ngIf="
                          articleMasterConditions.controls
                            .isDetailedConditionApplicable.errors?.required
                        "
                      >
                        Please add inclusion condition.
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  *ngIf="
                    articleMasterConditions.controls
                      .isDetailedConditionApplicable.value
                  "
                >
                  <div formArrayName="articleMasterDetailedConditions">
                    <div
                      *ngFor="
                        let articleMasterDetailedConditions of getArticleMasterDetailedConditions(
                          articleMasterConditions
                        );
                        let j = index
                      "
                      class="panel panel-default"
                    >
                      <div class="panel-body" [formGroupName]="j">
                        <div class="form-row">
                          <div
                            class="form-group col-md-4"
                            [ngClass]="{
                              'field-invalid':
                                submitted &&
                                articleMasterDetailedConditions.get('condition')
                                  .errors
                            }"
                          >
                            <label
                              >Detailed inclusion condition{{ j + 1 }}</label
                            >
                            <input
                              type="text"
                              class="input-ctrl"
                              maxlength="100"
                              placeholder="Enter detailed inclusion condition"
                              formControlName="condition"
                            />
                            <div
                              *ngIf="
                                submitted &&
                                articleMasterDetailedConditions.get('condition')
                                  .errors
                              "
                              class="error-feedback"
                            >
                              <div
                                *ngIf="
                                  articleMasterDetailedConditions.get(
                                    'condition'
                                  ).errors?.required
                                "
                              >
                                Please enter Detailed inclusion condition.
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-4 ui-inputgroup mb-0 pt-30">
                            <button
                              type="button"
                              *ngIf="j !== 0 && actionState !== 'VIEW'"
                              class="ui-button btn-secondary"
                              (click)="removeCondition(j)"
                            >
                              Remove
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button
                    (click)="addArticlelist(i)"
                    *ngIf="actionState !== 'VIEW'"
                    class="ui-button btn-primary"
                    [disabled]="
                      actionState === 'EDIT' || actionState === 'VIEW'
                    "
                  >
                    <i class="fas fa-plus-circle"></i> Add New
                  </button>
                </div>
              </div>
              <div
                *ngIf="articleMasterForm.value.isInclusionOrExclusion === false"
              >
                <div
                  [ngClass]="{
                    'field-invalid':
                      submitted &&
                      articleMasterConditions.get('condition').errors
                  }"
                >
                  <label>Exclusion condition</label>
                  <input
                    type="text"
                    maxlength="100"
                    placeholder="Enter exclusion condition"
                    class="input-ctrl"
                    formControlName="condition"
                    pInputText
                  />
                  <div
                    *ngIf="
                      submitted &&
                      articleMasterConditions.get('condition').errors
                    "
                    class="error-feedback"
                  >
                    <div
                      *ngIf="
                        articleMasterConditions.get('condition').errors
                          ?.required
                      "
                    >
                      Please enter an exclusion condition.
                    </div>
                  </div>
                </div>
                <div class="ui-inputgroup ui-g-12 mt-10">
                  <label for="inputPassword4"
                    >Is a detailed exclusion condition applicable?</label
                  >
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="isDetailedConditionApplicable"
                      id="subNatureOfPaymentRadios3"
                      [value]="true"
                      formControlName="isDetailedConditionApplicable"
                      (change)="disableDetailsFields(true)"
                    />
                    <label class="form-check-label" for="exampleRadios1">
                      Yes
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="isDetailedConditionApplicable"
                      id="subNatureOfPaymentRadios3"
                      [value]="false"
                      formControlName="isDetailedConditionApplicable"
                      (change)="disableDetailsFields(false)"
                    />
                    <label class="form-check-label" for="exampleRadios2">
                      No
                    </label>
                    <div
                      *ngIf="
                        submitted &&
                        articleMasterConditions.controls
                          .isDetailedConditionApplicable.errors
                      "
                      class="error-feedback"
                    >
                      <div
                        *ngIf="
                          articleMasterConditions.controls
                            .isDetailedConditionApplicable.errors?.required
                        "
                      >
                        Please add exclusion condition.
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  *ngIf="
                    articleMasterConditions.controls
                      .isDetailedConditionApplicable.value
                  "
                >
                  <div formArrayName="articleMasterDetailedConditions">
                    <div
                      *ngFor="
                        let articleMasterDetailedConditions of getArticleMasterDetailedConditions(
                          articleMasterConditions
                        );
                        let j = index
                      "
                      class="panel panel-default"
                    >
                      <div class="panel-body" [formGroupName]="j">
                        <div class="form-row">
                          <div
                            class="form-group col-md-4"
                            [ngClass]="{
                              'field-invalid':
                                submitted &&
                                articleMasterDetailedConditions.get('condition')
                                  .errors
                            }"
                          >
                            <label
                              >Detailed exclusion condition{{ j + 1 }}</label
                            >
                            <input
                              type="text"
                              class="input-ctrl"
                              maxlength="100"
                              placeholder="Enter detailed exclusion condition"
                              formControlName="condition"
                            />
                            <div
                              *ngIf="
                                submitted &&
                                articleMasterDetailedConditions.get('condition')
                                  .errors
                              "
                              class="error-feedback"
                            >
                              <div
                                *ngIf="
                                  articleMasterDetailedConditions.get(
                                    'condition'
                                  ).errors?.required
                                "
                              >
                                Please enter Detailed exclusion condition.
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-4 ui-inputgroup mb-0 pt-30">
                            <button
                              type="button"
                              *ngIf="j !== 0"
                              class="ui-button btn-secondary"
                              (click)="removeCondition(j)"
                            >
                              Remove
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button
                    (click)="addArticlelist(i)"
                    [disabled]="
                      actionState === 'EDIT' || actionState === 'VIEW'
                    "
                    class="ui-button btn-primary"
                  >
                    <i class="fas fa-plus-circle"></i> Add New
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="ui-inputgroup ui-g-12">
      <div class="cust-overflow">
        <div
          class="cust-lable-ng-p"
          [ngClass]="{ 'field-invalid': submitted && f.articleRate.errors }"
        >
          <label>Rate</label>
          <input
            type="number"
            eyRatedecimalfloter
            formControlName="articleRate"
            placeholder="Enter rate"
            class="input-ctrl w-100"
          />
          <span class="ui-inputgroup-addon">%</span>
          <div *ngIf="submitted && f.articleRate.errors" class="error-feedback">
            <div *ngIf="f.articleRate.errors?.required">
              Please enter rate.
            </div>
          </div>
        </div>
      </div>
      <div class="form-row mt-10">
        <div
          class="ui-inputgroup ui-g-6"
          [ngClass]="{
            'field-invalid': submitted && f.applicableFrom.errors
          }"
        >
          <label for="inputCity"> Applicable from</label>
          <div class="input-group">
            <input
              class="form-control"
              placeholder="dd-mm-yyyy"
              name="dp"
              id="applicableFrom"
              formControlName="applicableFrom"
              ngbDatepicker
              placement="auto"
              #applicableFrom="ngbDatepicker"
              [value]="
                articleMasterForm.getRawValue().applicableFrom
                  | date: 'dd-MM-yyyy'
              "
            />
            <div class="input-group-append">
              <button
                class="btn btn-secondary calendar fs-14"
                (click)="applicableFrom.toggle()"
                type="button"
              >
                <i class="fas fa-calendar-alt"></i>
              </button>
            </div>
          </div>
          <div
            *ngIf="submitted && f.applicableFrom.errors"
            class="error-feedback"
          >
            <div *ngIf="f.applicableFrom.errors?.required">
              Please enter applicable from.
            </div>
          </div>
        </div>
        <div
          class="ui-inputgroup ui-g-6"
          [ngClass]="{
            'field-invalid':
              (submitted && f.applicableTo.errors) || applicableToDateError
          }"
        >
          <label for="inputState">Applicable to (optional)</label>
          <div class="input-group">
            <input
              class="form-control"
              placeholder="dd-mm-yyyy"
              [minDate]="minDate"
              (click)="d.toggle()"
              name="dp"
              formControlName="applicableTo"
              ngbDatepicker
              placement="auto"
              #d="ngbDatepicker"
              [value]="
                articleMasterForm.value.applicableTo | date: 'dd-MM-yyyy'
              "
            />
            <div class="input-group-append">
              <button
                class="btn btn-secondary calendar fs-14"
                (click)="d.toggle()"
                type="button"
              >
                <i class="fas fa-calendar-alt"></i>
              </button>
            </div>
          </div>
          <div
            *ngIf="
              (submitted && f.applicableTo.errors) || applicableToDateError
            "
            class="error-feedback"
          >
            <p *ngIf="applicableToDateError">
              Applicable to date must be more than that of Applicable from date.
            </p>
            <p *ngIf="submitted && f.applicableTo.errors?.required">
              Please enter applicable to.
            </p>
          </div>
        </div>
      </div>

      <div class="ui-inputgroup">
        <button (click)="goBack()" type="button" class="ui-button btn-utility">
          <i class="fas fa-arrow-left"></i> Back
        </button>

        <button
          (click)="saveArticlelist('addNew')"
          type="button"
          class="ui-button btn-secondary"
          *ngIf="actionState !== 'EDIT' && actionState !== 'VIEW'"
        >
          <i class="fas fa-save"></i> Save &amp; Add New
        </button>
        <button
          (click)="saveArticlelist('back')"
          type="button"
          class="ui-button btn-primary"
          *ngIf="actionState !== 'EDIT' && actionState !== 'VIEW'"
        >
          <i class="fas fa-save"></i> Save
        </button>
        <span *HasAnyAuthority="['ARTICLE_UPDATE']">
          <button
            (click)="updateArticlelist()"
            type="button"
            class="ui-button btn-primary"
            *ngIf="actionState === 'EDIT'"
          >
            Update
          </button>
        </span>
      </div>
    </div>
  </form>
</div>
