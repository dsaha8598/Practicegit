<div class="container">
  <div class="row">
    <div class="col-sm-6">
      <div class="ui-g-6 mx-0">
        <h2 class="fs-22">{{ headingMsg }} Surcharge Master</h2>
      </div>
    </div>
    <div class="col-sm-6 text-right">
      <span *HasAnyAuthority="['TCS_SURCHARGE_UPDATE']">
        <button
          (click)="stateChanger('edit')"
          type="button"
          class="ui-button btn-primary"
          *ngIf="actionState === 'VIEW'"
        >
          Edit
        </button>
      </span>
    </div>
  </div>
</div>
<div class="container mt-30">
  <div class="row">
    <div class="col-sm-12">
      <form [formGroup]="surchargeForm">
        <!--   <div class="row">
          <div class="col-sm-12">
            <div class="form-group mb-30">
              <div
                class="row"
                [ngClass]="{
                  'field-invalid': submitted && f.surchargeApplicable.errors
                }"
              >
                <div class="col-sm-12">
                  <label class="mb-10">
                    Is surcharge applicable at flat rate for all collectee for
                    all nature of incomes?
                  </label>
                </div>
                <div class="col-sm-1">
                  <input
                    formControlName="surchargeApplicable"
                    type="radio"
                    name="surchargeApplicable"
                    id="isSurchargeApplicableYes"
                    ngDefaultControl
                    [value]="true"
                    checked="checked"
                    (change)="changeHandler()"
                  />
                  <label
                    class="form-check-label"
                    for="isSurchargeApplicableYes"
                  >
                    Yes
                  </label>
                </div>
                <div class="col-sm-1">
                  <input
                    formControlName="surchargeApplicable"
                    type="radio"
                    name="surchargeApplicable"
                    id="isSurchargeApplicableNo"
                    ngDefaultControl
                    [value]="false"
                    (change)="changeHandler()"
                  />
                  <label class="form-check-label" for="isSurchargeApplicableNo">
                    No
                  </label>
                </div>
                <div class="col-sm-12">
                  <div
                    *ngIf="submitted && f.surchargeApplicable.errors"
                    class="error-feedback"
                  >
                    <p *ngIf="f.surchargeApplicable.errors.required">
                      Please select surcharge applicable.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div> -->
        <!--  <div
          class="row"
          *ngIf="surchargeForm.getRawValue().surchargeApplicable === true"
        >
          <div class="col-sm-6 mb-20 ui-inputgroup">
            <div
              class="form-group  "
              [ngClass]="{
                'field-invalid': submitted && f.surchargeRate.errors
              }"
            >
              <div
                class="cust-lable-bs-p cust-lable-bs-p-t-29 cust-label-34 cust-label-35"
              >
                <label for="surchargeRate" class="mb-7">Surcharge rate</label>
                <input
                  type="number"
                  eyRatedecimalfloter
                  name="surchargeRate"
                  class="input-ctrl w-100"
                  id="surchargeRate"
                  formControlName="surchargeRate"
                />
                <span class="ui-inputgroup-addon">%</span>
                <div
                  *ngIf="submitted && f.surchargeRate.errors"
                  class="error-feedback"
                >
                  <p *ngIf="f.surchargeRate.errors.required">
                    Please enter rate.
                  </p>
                  <p *ngIf="f.surchargeRate.errors.maxlength">
                    Rate must not exceed 2 characters.
                  </p>
                  <p *ngIf="f.surchargeRate.errors.pattern">
                    Please enter only digits.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div> -->
        <div class="row" formArrayName="basisOfSurchargeDetails">
          <div
            class="col-sm-12 bg-light p-20 my-20"
            *ngFor="
              let surcharge of getSurchargeDetails(surchargeForm);
              let i = index
            "
          >
            <div class="row" [formGroupName]="i">
              <div class="col-sm-12">
                <div class="row">
                  <div class="col-sm-6 mb-20">
                    <div
                      class="form-group"
                      [ngClass]="{
                        'field-invalid':
                          submitted && surcharge.get('collecteeStatusId').errors
                      }"
                    >
                      <label for="collecteeStatusId">Collectee status</label>
                      <p-dropdown
                        [options]="getCollecteeStatusList"
                        id="collecteeStatusId"
                        name="collecteeStatusId"
                        ngDefaultControl
                        formControlName="collecteeStatusId"
                      >
                      </p-dropdown>
                      <div
                        *ngIf="
                          submitted && surcharge.get('collecteeStatusId').errors
                        "
                        class="error-feedback"
                      >
                        Please select the collectee status from the drop down
                        list.
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 mb-20">
                    <div
                      class="form-group ui-inputgroup"
                      [ngClass]="{
                        'field-invalid':
                          submitted &&
                          surcharge.get('collecteeResidentialStatus').errors
                      }"
                    >
                      <label for="collecteeResidentialStatus"
                        >Collectee residential status</label
                      >
                      <!-- <p-dropdown
                        [options]="getCollecteeResidentialStatusIdList"
                        id="collecteeResidentialStatusIdId"
                        name="collecteeResidentialStatusIdId"
                        ngDefaultControl
                        formControlName="collecteeResidentialStatusIdId"
                        (onChange)="collecteeReshandleData($event,i)"
                      >
                      </p-dropdown>
                       -->
                      <input
                        type="text"
                        name="collecteeResidentialStatus"
                        id="collecteeResidentialStatus"
                        class="input-ctrl"
                        ngDefaultControl
                        formControlName="collecteeResidentialStatus"
                      />
                      <div
                        *ngIf="
                          submitted &&
                          surcharge.get('collecteeResidentialStatus').errors
                        "
                        class="error-feedback"
                      >
                        Please select the collectee residential status from the
                        drop down list.
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-6 ui-inputgroup">
                    <div
                      class="form-group ui-inputgroup "
                      [ngClass]="{
                        'field-invalid':
                          submitted && surcharge.get('invoiceSlabFrom').errors
                      }"
                    >
                      <label for="invoiceSlabFrom">Amount from</label>
                      <input
                        type="number"
                        name="invoiceSlabFrom"
                        class="input-ctrl width-100"
                        id="invoiceSlabFrom"
                        placeholder="0"
                        formControlName="invoiceSlabFrom"
                      />
                      <div
                        *ngIf="
                          submitted && surcharge.get('invoiceSlabFrom').errors
                        "
                        class="error-feedback"
                      >
                        <p *ngIf="surcharge.get('invoiceSlabFrom').errors">
                          Please enter amount.
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6  mb-20">
                    <div
                      class="form-group ui-inputgroup"
                      [ngClass]="{
                        'field-invalid':
                          submitted && surcharge.get('invoiceSlabTo').errors
                      }"
                    >
                      <label for="invoiceSlabTo">Amount to (optional)</label>
                      <input
                        type="number"
                        name="invoiceSlabTo"
                        class="input-ctrl width-100"
                        id="invoiceSlabTo"
                        placeholder="0"
                        formControlName="invoiceSlabTo"
                      />
                      <div
                        *ngIf="
                          submitted && surcharge.get('invoiceSlabTo').errors
                        "
                        class="error-feedback"
                      >
                        <p *ngIf="surcharge.get('invoiceSlabTo').errors">
                          Please enter invoice slab to.
                        </p>
                      </div>
                    </div>
                  </div>
                  <!--   <div class="col-sm-4  mb-20">
                    <div
                      class="form-group"
                      [ngClass]="{
                        'field-invalid':
                          submitted &&
                          surcharge.get('natureOfIncomeMasterId').errors
                      }"
                    >
                      <label for="natureOfIncomeMasterId"
                        >Nature of income</label
                      >
                      <p-dropdown
                        [options]="getNatureofIncomeList"
                        id="natureOfIncomeMasterId"
                        name="natureOfIncomeMasterId"
                        [value]="
                          surchargeForm.getRawValue().natureOfIncomeMasterId
                        "
                        ngDefaultControl
                        formControlName="natureOfIncomeMasterId"
                      >
                      </p-dropdown>
                      <div
                        *ngIf="
                          submitted &&
                          surcharge.get('natureOfIncomeMasterId').errors
                        "
                        class="error-feedback"
                      >
                        Please select nature of income for which the surcharge
                        needs to be applied.
                      </div>
                    </div>
                  </div> -->
                </div>
                <div class="row">
                  <div class="col-sm-6 ui-inputgroup">
                    <div
                      class="mb-20 cust-lable-bs-p cust-lable-bs-p-t-29 cust-label-34"
                      [ngClass]="{
                        'field-invalid':
                          submitted && surcharge.get('rate').errors
                      }"
                    >
                      <label for="rate" class="mb-7">Surcharge rate</label>
                      <input
                        type="number"
                        eyRatedecimalfloter
                        name="rate"
                        class="input-ctrl w-100"
                        id="rate"
                        formControlName="rate"
                      />
                      <span class="ui-inputgroup-addon">%</span>

                      <div
                        *ngIf="submitted && surcharge.get('rate').errors"
                        class="error-feedback"
                      >
                        <p *ngIf="surcharge.get('rate').errors">
                          Please enter rate.
                        </p>
                        <p *ngIf="surcharge.get('rate').errors.maxlength">
                          Rate must not exceed 2 characters.
                        </p>
                        <p *ngIf="surcharge.get('rate').errors.pattern">
                          Please enter only digits.
                        </p>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4 text-right mb-20">
                    <button
                      type="button"
                      *ngIf="i !== 0"
                      [disabled]="
                        actionState === 'EDIT' || actionState === 'VIEW'
                      "
                      class="ui-button btn-primary mt-38"
                      (click)="removeSurchargeDetails(i)"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-20" *ngIf="showForm">
          <div class="col-sm-12">
            <button
              type="button"
              class="ui-button btn-secondary"
              (click)="addSurchargeDetails()"
              [disabled]="actionState === 'EDIT' || actionState === 'VIEW'"
            >
              <i class="fas fa-plus-circle"></i> Add New
            </button>
          </div>
        </div>
        <div class="row">
          <div
            class="ui-inputgroup col-sm-6"
            [ngClass]="{
              'field-invalid': submitted && f.applicableFrom.errors
            }"
          >
            <label for="applicableFrom">Applicable from</label>
            <div class="input-group ">
              <input
                class="form-control"
                placeholder="dd-mm-yyyy"
                name="dp"
                id="applicableFrom"
                formControlName="applicableFrom"
                ngbDatepicker
                placement="auto"
                #applicableFrom="ngbDatepicker"
                [value]="
                  surchargeForm.getRawValue().applicableFrom
                    | date: 'dd-MM-yyyy'
                "
              />
              <div class="input-group-append">
                <button
                  class="btn btn-secondary calendar fs-14"
                  (click)="applicableFrom.toggle()"
                  type="button"
                >
                  <i class="fas fa-calendar-alt"></i>
                </button>
              </div>
            </div>
            <div
              *ngIf="submitted && f.applicableFrom.errors"
              class="error-feedback"
            >
              <p *ngIf="f.applicableFrom.errors.required">
                Please enter applicable from.
              </p>
            </div>
          </div>
          <div
            class="ui-inputgroup col-sm-6"
            [ngClass]="{
              'field-invalid':
                (submittedTo && f.applicableTo.errors) || applicableToDateError
            }"
          >
            <label for="inputState">Applicable to (optional)</label>
            <div class="input-group">
              <input
                class="form-control"
                placeholder="dd-mm-yyyy"
                [minDate]="minDate"
                (click)="d.toggle()"
                autocomplete="false"
                name="dp"
                formControlName="applicableTo"
                ngbDatepicker
                placement="auto"
                #d="ngbDatepicker"
                [value]="surchargeForm.value.applicableTo | date: 'dd-MM-yyyy'"
              />
              <div class="input-group-append">
                <button
                  class="btn btn-secondary calendar fs-14"
                  (click)="d.toggle()"
                  id="applicable"
                  type="button"
                >
                  <i class="fas fa-calendar-alt"></i>
                </button>
              </div>
            </div>
            <div
              *ngIf="
                (submittedTo && f.applicableTo.errors) || applicableToDateError
              "
              class="error-feedback"
            >
              <p *ngIf="applicableToDateError">
                Applicable to date must be more than that of Applicable from
                date.
              </p>
              <p *ngIf="f.applicableTo.errors.required">
                Please enter applicable to.
              </p>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <button
              type="button"
              class="ui-button btn-utility mr-20"
              (click)="back()"
            >
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <button
              type="button"
              class="ui-button btn-secondary  mr-20"
              (click)="saveSurcharge('addNew')"
              *ngIf="actionState !== 'EDIT' && actionState !== 'VIEW'"
            >
              <i class="fas fa-save"></i> Save &amp; Add New
            </button>
            <button
              type="button"
              class="ui-button btn-primary"
              (click)="saveSurcharge('back')"
              *ngIf="actionState !== 'EDIT' && actionState !== 'VIEW'"
            >
              <i class="fas fa-save"></i> Save
            </button>
            <span *HasAnyAuthority="['TCS_SURCHARGE_UPDATE']">
              <button
                (click)="updateSurcharge()"
                type="button"
                class="ui-button btn-primary"
                *ngIf="actionState === 'EDIT'"
              >
                Update
              </button>
            </span>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
