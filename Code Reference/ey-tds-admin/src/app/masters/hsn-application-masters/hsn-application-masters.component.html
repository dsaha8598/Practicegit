<div class="ui-g-12">
  <div
    class="row mr-5"
    style="float: right;"
    *HasAnyAuthority="['HSN_DESCRIPTION_UPLOAD']"
  >
    <ey-download-template
      class="mr-5"
      [templateName]="'HSN template'"
      [templateType]="'HSN'"
    >
    </ey-download-template>
    <ey-download-nop class="mr-5"> </ey-download-nop>
    <button
      type="button"
      class="ui-button btn-primary  mr-5"
      (click)="showDialog()"
    >
      <i class="fas fa-upload"></i> Upload
    </button>
    <button
      type="button"
      class="ui-button btn-primary  mr-5"
      [routerLink]="['form']"
    >
      <i class="fas fa-plus-circle"></i> Add new
    </button>
    <button
      type="button"
      class="ui-button btn-secondary  mr-5"
      (click)="refreshData()"
    >
      <i class="fas fa-sync"></i> Refresh data
    </button>
  </div>
</div>

<div class="ui-g-12">
  <div class="relative">
    <p-tabView class="table-tab-view" (onChange)="onTabChange($event)">
      <p-tabPanel header="HSN list">
        <ey-pagination
          #resident
          [tableColumns]="selectedColumns"
          [pageObjectInput]="hsnDescList"
          (pageObjectEmitter)="setPageObject($event)"
          [type]="'TDS_HSN_CODE_EXCEL_APPLICATION'"
        >
          <!--  <ng-template #searchFilter>
            <ey-deductee-resident-dropdown
              [isDeducteeMaster]="true"
              (onChange)="filterDatabyDeducteeName($event, 'resident')"
            >
            </ey-deductee-resident-dropdown>
          </ng-template> -->
        </ey-pagination>
      </p-tabPanel>
      <p-tabPanel header="File processing status">
        <ey-batch-upload-table
          [tableData]="statusList"
          [fileType]="fileTypeOf"
          (year)="getSelectedYear($event)"
        >
        </ey-batch-upload-table>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>

<div class="fixed-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <button
          (click)="backClick()"
          type="button"
          class="ui-button btn-utility"
        >
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>
    </div>
  </div>
</div>

<p-dialog
  header="Upload"
  [(visible)]="display"
  [style]="{ width: '800px' }"
  [modal]="true"
  [contentStyle]="{ overflow: 'visible' }"
  [minY]="70"
  (onHide)="clearUpload()"
  [maximizable]="true"
  [baseZIndex]="10000"
>
  <form [formGroup]="hsnUploadForm">
    <div class="p-20">
      <div
        class="no-files m-20"
        *ngIf="!filesExists && !uploadSuccess && !uploadError && !fileLoading"
      >
        <p class="fs-18">
          No files added. Please click add files button to upload files.
        </p>
        <span class="fs-14 mt-20">
          Note: Upload .xlsx files only.
        </span>
      </div>
      <div class="text-center my-50" *ngIf="fileLoading">
        <i class="fs-24 fas fa-hourglass-start fa-spin text-success mb-30"></i>
        <p class="fs-16">Your file is being processed. please wait.</p>
      </div>
      <div class="text-center my-50" *ngIf="uploadSuccess">
        <i class="fs-80 fa fa-check-circle text-success mb-30"></i>
        <p class="fs-24">File Uploaded Successfully.</p>
      </div>
      <div class="text-center my-50" *ngIf="uploadError">
        <i class="fs-80 fa fa-times text-danger mb-30"></i>
        <p class="fs-24">Processing failed.</p>
      </div>
      <div
        class="files p-20"
        *ngIf="filesExists && !uploadSuccess && !uploadError && !fileLoading"
      >
        <div class="alert alert-success">
          {{ rawValues?.file.length }} has been added successfully. Please click
          upload files to process files.
        </div>
        <div
          class="bg-light mb-10 p-20 row mx-0"
          *ngFor="let file of rawValues.file; let i = index"
        >
          <div class="col-sm-8">
            {{ file.name }}
          </div>
          <div class="col-sm-2">
            {{ formatBytes(file.size) }}
          </div>
          <div class="col-sm-2">
            <button
              type="button"
              class="ui-button btn-secondary"
              (click)="removeFiles()"
            >
              <i class="pi pi-times"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
  <p-footer *ngIf="!fileLoading && !uploadSuccess && !uploadError">
    <span *ngIf="!filesExists">
      <input
        type="file"
        class="inputfile"
        id="keywordsfiles"
        (change)="uploadHandler($event)"
        accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
      />
      <label for="keywordsfiles" class="mb-0">Add files</label>
    </span>
    <button
      type="button"
      class="ui-button btn-secondary"
      *ngIf="filesExists"
      (click)="uploadFiles()"
    >
      Upload files
    </button>
  </p-footer>
</p-dialog>
